# Проект: Инструмент командной строки для учебного и конфигурационного синтаксиса

## Описание
Этот проект представляет собой инструмент командной строки, работающий на основе python приложения. Основная цель — преобразование текста. 

Основные возможности программы:
- Работа с массивами.
- Работа с комментариями.
- Работа с числами.
- Работа со строками.


## Установка
```bash
 - git clone https://github.com/liftoachpandemonium/config3.git
```

## Классы

### `ConfigParser`

Класс для обработки текста конфигурационного файла и преобразования его в формат TOML.

#### Параметры:
- `input_text` (строка): Входной текст конфигурационного файла, который необходимо обработать.

#### Методы:

##### `parse()`
Метод обрабатывает входной текст конфигурации, удаляет многострочные комментарии и парсит ключи и значения для дальнейшего преобразования в формат TOML. Также этот метод вычисляет значения констант, указанных в конфигурационном файле.

- **Как работает**:
  1. В начале вызывается метод `_remove_multiline_comments(self.text)`, который удаляет все многострочные комментарии из текста.
  2. После этого текст разделяется на строки. Каждая строка проверяется на наличие символа "->" (указывающего на объявление константы) или выражений в формате `^{...}` (константные выражения для вычислений).
  3. Если строка соответствует объявлению константы (например, `constant -> 5`), вызывается метод `_parse_constant_declaration()`.
  4. Для вычисления выражений в формате `^{...}`, таких как `^{2 + 2}`, строки добавляются в список `constant_expressions`.
  5. Оставшиеся строки разбиваются на ключи и значения и добавляются в результирующий словарь с помощью метода `_parse_key_value(line)`.
  6. После обработки всех строк, вызывается `_evaluate_constant_expression(line)`, чтобы вычислить и обновить результат для всех константных выражений.
  7. В конце метод возвращает словарь, который содержит финальные данные конфигурации в формате, подходящем для записи в TOML.

- **Возвращает**:
  - Возвращает словарь, в котором ключи — это параметры конфигурации, а значения — их соответствующие значения.

##### `_remove_multiline_comments(text)`
Метод удаляет многострочные комментарии из конфигурационного текста, которые заключены в `{-` и `-}`. Используется регулярное выражение для нахождения таких комментариев и удаления их из текста.

- **Как работает**:
  1. Применяет регулярное выражение `r'{-.*?-}'`, чтобы удалить все, что находится между `{` и `}` и содержит символы `-` на начала и концах.
  2. Используется флаг `re.DOTALL`, чтобы точка в регулярном выражении могла совпадать с символом новой строки, что позволяет корректно удалить многострочные комментарии.

- **Возвращает**:
  - Возвращает очищенный текст без многострочных комментариев.

##### `_parse_constant_declaration(line)`
Метод обрабатывает строки конфигурации, которые объявляют константы в формате `constant_name -> expression`. Вычисляет значение выражения и сохраняет результат в переменную.

- **Как работает**:
  1. Метод разделяет строку на две части по символу `->`.
  2. Левая часть (значение) передается в метод `_parse_value()`, который обрабатывает значение выражения.
  3. Правая часть — это имя константы, которое используется как ключ для сохранения вычисленного значения в словарь `variables`.

- **Возвращает**:
  - Не возвращает значения. Однако добавляет новую переменную (константу) в словарь `variables`.

##### `_evaluate_constant_expression(line)`
Метод вычисляет выражение константы, заданное в формате `^{expression}`, например, `^{2 + 3 * 5}`. При вычислении используется `eval()`, который выполняет строку как Python код.

- **Как работает**:
  1. Извлекает выражение между символами `^{}` и удаляет лишние пробелы.
  2. Использует функцию `eval()` для вычисления результата выражения, добавляя в контекст вычислений текущие переменные, хранящиеся в `self.variables`.
  3. Если вычисление успешное, возвращает словарь с результатом вычисления.

- **Возвращает**:
  - Возвращает словарь, где ключ — это строка с выражением, а значение — вычисленный результат этого выражения.

##### `_parse_key_value(line)`
Метод обрабатывает строки конфигурации в формате `key = value`. Он парсит ключ и значение, проверяя синтаксис и корректность значений.

- **Как работает**:
  1. Метод проверяет, что строка содержит символ `=`.
  2. Делит строку на две части: ключ и значение.
  3. Проверяет, что ключ соответствует правильному синтаксису с использованием регулярного выражения `^[_\w][_\w\d]*$`, что позволяет ключу состоять только из букв, цифр и подчеркиваний.
  4. Значение парсится с помощью метода `_parse_value(value)` для преобразования строки в нужный тип (например, строку, число или список).
  5. Добавляет переменную в `self.variables` и возвращает пару "ключ-значение".

- **Возвращает**:
  - Возвращает пару: ключ (строка) и значение (расшифрованное значение).

##### `_parse_value(value)`
Метод разбирает строковое значение и преобразует его в соответствующий тип данных: число, строку или список.

- **Как работает**:
  1. Если строка состоит только из цифр, она конвертируется в целое число.
  2. Если строка обрамлена двойными кавычками, она преобразуется в строку без кавычек.
  3. Если строка начинается с `list(` и заканчивается на `)`, она рассматривается как список, и каждый элемент в нем будет разобран методом `_parse_value()`.
  4. Если значение является переменной, она будет заменена на соответствующее значение из `self.variables`.

- **Возвращает**:
  - Возвращает значение после преобразования (число, строка или список).

## Основные функции

### `main()`
Основная функция для запуска программы, которая отвечает за чтение данных, их обработку и запись результата в файл.

- **Как работает**:
  1. Парсит аргументы командной строки с помощью модуля `argparse`. Пользователь передает пути к входному и выходному файлам.
  2. Открывает входной файл с конфигурацией и передает содержимое в объект `ConfigParser`.
  3. Вызывает метод `parse()` для обработки конфигурации.
  4. Результат сохраняется в файл TOML с использованием библиотеки `toml`.

- **Возвращает**:
  - Не возвращает значения. Результат записывается в файл.

## Настройка и запуск проекта

### Требования:
- Python 3.x
- Модуль `re` (для работы с регулярными выражениями)
- Модуль `argparse` (для парсинга командной строки)
- Модуль `toml` (для работы с форматированием TOML)

### Установка зависимостей:
Убедитесь, что установлен модуль `toml`:

```bash
pip install toml
```
   


   
### Пример работы программы
![image](https://github.com/user-attachments/assets/ff2d028d-cbb1-48de-bfa6-107460775ed3)
![image](https://github.com/user-attachments/assets/73a2f5ab-be62-4c7d-98ec-f42f9b486e11)



## Тестирование
Набор тестов проверяет функции для визуаоищации графа зависимостей, чтобы убедиться в их корректной работе в различных ситуациях. Тесты реализованы с использованием библиотеки `jest`, и включают следующие проверки:

## Описание тестов

Тесты для проекта написаны с использованием библиотеки Jest и направлены на проверку корректности работы функций по получению зависимостей, их визуализации и обработки ошибок.

### 1. **Тест: should fetch dependencies successfully**

**Цель:** Проверка успешного получения зависимостей для указанного пакета.

Этот тест проверяет, что функция `getDependencies` успешно извлекает зависимости для пакета `lodash`, если команда `execSync` возвращает корректный JSON, описывающий зависимости. Мокируется команда `npm ls`, которая возвращает объект зависимостей в виде строки JSON.

**Ожидаемый результат:**
- Функция должна вернуть объект с зависимостями.
- В объекте должны быть данные о пакете `lodash` и его зависимостях.

### 2. **Тест: should handle errors when fetching dependencies**

**Цель:** Проверка обработки ошибок при неудачном получении зависимостей.

**Описание:**  
В данном тесте смоделирована ошибка, которая возникает, если команда `execSync` вызывает исключение (например, если пакет не существует). Функция `getDependencies` должна вернуть `null` в случае возникновения ошибки, что обеспечивает правильную обработку исключений.

**Ожидаемый результат:**
- Функция должна вернуть `null`, если команда для получения зависимостей не удалась (например, из-за несуществующего пакета).

### 3. **Тест: should generate mermaid graph**

**Цель:** Проверка корректности генерации графа Mermaid на основе зависимостей.

**Описание:**  
Этот тест проверяет, что функция `generateMermaidGraph` правильно генерирует строку для графа Mermaid на основе входных данных о зависимостях. Мокируется объект зависимостей для пакета `lodash`, включающий зависимости для `lodash.isempty`. Ожидается, что строка будет включать отношения между `root`, `lodash` и `lodash.isempty`.

**Ожидаемый результат:**
- Сгенерированная строка должна содержать правильные связи для узлов в формате Mermaid, например `root-->lodash` и `lodash-->lodash.isempty`.

### 4. **Тест: should visualize graph (create an SVG file)**

**Цель:** Проверка корректности процесса визуализации графа и создания SVG-файла.

**Описание:**  
Этот тест проверяет, что функция `visualizeGraph` сохраняет строку графа в файл `.mmd` и вызывает команду для генерации изображения SVG с использованием инструмента `mmdc` (Mermaid CLI). Используется мокирование метода `writeFileSync` для проверки сохранения файла и мока команды для создания изображения в формате SVG.

**Ожидаемый результат:**
- Должен быть вызван метод `writeFileSync` для сохранения графа в файл `.mmd`.
- Команда `mmdc` должна быть вызвана для создания SVG изображения.

### 5. **Тест: should handle graph creation failure**

**Цель:** Проверка обработки ошибки при создании графа.

**Описание:**  
Этот тест проверяет, что происходит, если команда для генерации SVG (с помощью `mmdc`) не удалась, и обрабатывает ли система это корректно. Мокируется ошибка в процессе создания графа, и проверяется, что в случае ошибки выводится сообщение об ошибке "Не удалось получить зависимости."

**Ожидаемый результат:**
- Если процесс генерации графа завершился с ошибкой, должно быть выведено сообщение "Не удалось получить зависимости."
  
## Как запускать тесты

После установки всех зависимостей, запустите тесты с помощью команды:

```bash
npm test
```
![image](https://github.com/user-attachments/assets/9905b040-e1a1-476c-8d8e-e3324a629b07)


