# Проект: Инструмент командной строки для учебного и конфигурационного синтаксиса

## Описание
Этот проект представляет собой инструмент командной строки, работающий на основе python приложения. Основная цель — преобразование текста. 

Основные возможности программы:
- Работа с массивами.
- Работа с комментариями.
- Работа с числами.
- Работа со строками.


## Установка
```bash
 - git clone https://github.com/liftoachpandemonium/config3.git
```

## Классы

### `ConfigParser`

Класс для обработки текста конфигурационного файла и преобразования его в формат TOML.

#### Параметры:
- `input_text` (строка): Входной текст конфигурационного файла, который необходимо обработать.

#### Методы:

##### `parse()`
Метод обрабатывает входной текст конфигурации, удаляет многострочные комментарии и парсит ключи и значения для дальнейшего преобразования в формат TOML. Также этот метод вычисляет значения констант, указанных в конфигурационном файле.

- **Как работает**:
  1. В начале вызывается метод `_remove_multiline_comments(self.text)`, который удаляет все многострочные комментарии из текста.
  2. После этого текст разделяется на строки. Каждая строка проверяется на наличие символа "->" (указывающего на объявление константы) или выражений в формате `^{...}` (константные выражения для вычислений).
  3. Если строка соответствует объявлению константы (например, `constant -> 5`), вызывается метод `_parse_constant_declaration()`.
  4. Для вычисления выражений в формате `^{...}`, таких как `^{2 + 2}`, строки добавляются в список `constant_expressions`.
  5. Оставшиеся строки разбиваются на ключи и значения и добавляются в результирующий словарь с помощью метода `_parse_key_value(line)`.
  6. После обработки всех строк, вызывается `_evaluate_constant_expression(line)`, чтобы вычислить и обновить результат для всех константных выражений.
  7. В конце метод возвращает словарь, который содержит финальные данные конфигурации в формате, подходящем для записи в TOML.

- **Возвращает**:
  - Возвращает словарь, в котором ключи — это параметры конфигурации, а значения — их соответствующие значения.

##### `_remove_multiline_comments(text)`
Метод удаляет многострочные комментарии из конфигурационного текста, которые заключены в `{-` и `-}`. Используется регулярное выражение для нахождения таких комментариев и удаления их из текста.

- **Как работает**:
  1. Применяет регулярное выражение `r'{-.*?-}'`, чтобы удалить все, что находится между `{` и `}` и содержит символы `-` на начала и концах.
  2. Используется флаг `re.DOTALL`, чтобы точка в регулярном выражении могла совпадать с символом новой строки, что позволяет корректно удалить многострочные комментарии.

- **Возвращает**:
  - Возвращает очищенный текст без многострочных комментариев.

##### `_parse_constant_declaration(line)`
Метод обрабатывает строки конфигурации, которые объявляют константы в формате `constant_name -> expression`. Вычисляет значение выражения и сохраняет результат в переменную.

- **Как работает**:
  1. Метод разделяет строку на две части по символу `->`.
  2. Левая часть (значение) передается в метод `_parse_value()`, который обрабатывает значение выражения.
  3. Правая часть — это имя константы, которое используется как ключ для сохранения вычисленного значения в словарь `variables`.

- **Возвращает**:
  - Не возвращает значения. Однако добавляет новую переменную (константу) в словарь `variables`.

##### `_evaluate_constant_expression(line)`
Метод вычисляет выражение константы, заданное в формате `^{expression}`, например, `^{2 + 3 * 5}`. При вычислении используется `eval()`, который выполняет строку как Python код.

- **Как работает**:
  1. Извлекает выражение между символами `^{}` и удаляет лишние пробелы.
  2. Использует функцию `eval()` для вычисления результата выражения, добавляя в контекст вычислений текущие переменные, хранящиеся в `self.variables`.
  3. Если вычисление успешное, возвращает словарь с результатом вычисления.

- **Возвращает**:
  - Возвращает словарь, где ключ — это строка с выражением, а значение — вычисленный результат этого выражения.

##### `_parse_key_value(line)`
Метод обрабатывает строки конфигурации в формате `key = value`. Он парсит ключ и значение, проверяя синтаксис и корректность значений.

- **Как работает**:
  1. Метод проверяет, что строка содержит символ `=`.
  2. Делит строку на две части: ключ и значение.
  3. Проверяет, что ключ соответствует правильному синтаксису с использованием регулярного выражения `^[_\w][_\w\d]*$`, что позволяет ключу состоять только из букв, цифр и подчеркиваний.
  4. Значение парсится с помощью метода `_parse_value(value)` для преобразования строки в нужный тип (например, строку, число или список).
  5. Добавляет переменную в `self.variables` и возвращает пару "ключ-значение".

- **Возвращает**:
  - Возвращает пару: ключ (строка) и значение (расшифрованное значение).

##### `_parse_value(value)`
Метод разбирает строковое значение и преобразует его в соответствующий тип данных: число, строку или список.

- **Как работает**:
  1. Если строка состоит только из цифр, она конвертируется в целое число.
  2. Если строка обрамлена двойными кавычками, она преобразуется в строку без кавычек.
  3. Если строка начинается с `list(` и заканчивается на `)`, она рассматривается как список, и каждый элемент в нем будет разобран методом `_parse_value()`.
  4. Если значение является переменной, она будет заменена на соответствующее значение из `self.variables`.

- **Возвращает**:
  - Возвращает значение после преобразования (число, строка или список).

## Основные функции

### `main()`
Основная функция для запуска программы, которая отвечает за чтение данных, их обработку и запись результата в файл.

- **Как работает**:
  1. Парсит аргументы командной строки с помощью модуля `argparse`. Пользователь передает пути к входному и выходному файлам.
  2. Открывает входной файл с конфигурацией и передает содержимое в объект `ConfigParser`.
  3. Вызывает метод `parse()` для обработки конфигурации.
  4. Результат сохраняется в файл TOML с использованием библиотеки `toml`.

- **Возвращает**:
  - Не возвращает значения. Результат записывается в файл.

## Настройка и запуск проекта

### Требования:
- Python 3.x
- Модуль `re` (для работы с регулярными выражениями)
- Модуль `argparse` (для парсинга командной строки)
- Модуль `toml` (для работы с форматированием TOML)

### Установка зависимостей:
Убедитесь, что установлен модуль `toml`:

```bash
pip install toml
```
   


   
### Пример работы программы
#### Входные данные
![image](https://github.com/user-attachments/assets/2a3f72af-f67c-4467-aa6a-613147296d69)
#### выходные данные
![image](https://github.com/user-attachments/assets/0902c714-da3d-4bf3-bc06-60230eef0476)



## Тестирование

Для тестирования использована библиотека `unittest`, которая проверяет функциональность класса `ConfigParser`. Тесты охватывают основные сценарии, такие как парсинг конфигурации, обработка констант, вычисление выражений, а также обработка ошибок.

### Описание тестов

#### 1. **Тест: should parse configuration correctly**

**Цель:** Проверка корректности парсинга конфигурационного текста.

**Описание:** Этот тест проверяет, что метод `parse()` правильно разбивает строки конфигурации на ключи и значения, корректно обрабатывает числовые, строковые и списковые типы данных.

**Ожидаемый результат:**
- Конфигурация должна быть успешно распарсена в словарь с правильными ключами и значениями.

#### 2. **Тест: should handle constant declarations**

**Цель:** Проверка обработки объявления констант в конфигурации.

**Описание:** Этот тест проверяет, что метод корректно обрабатывает строки с объявлением констант и сохраняет их в словарь.

**Ожидаемый результат:**
- Константы должны быть корректно сохранены и доступны для дальнейшего использования в конфигурации.

#### 3. **Тест: should evaluate constant expressions correctly**

**Цель:** Проверка вычисления выражений типа `^{...}`.

**Описание:** Тест проверяет, что метод `_evaluate_constant_expression()` корректно вычисляет выражения, содержащие переменные и математические операции.

**Ожидаемый результат:**
- Выражение должно быть правильно вычислено, и результат должен быть добавлен в итоговый словарь конфигурации.

#### 4. **Тест: should handle invalid constant expressions**

**Цель:** Проверка обработки ошибок при вычислении некорректных выражений.

**Описание:** Этот тест проверяет, что метод `_evaluate_constant_expression()` правильно обрабатывает ошибки при некорректных или невалидных выражениях.

**Ожидаемый результат:**
- При некорректном выражении должен быть вызван `ValueError` с соответствующим сообщением об ошибке.

#### 5. **Тест: should handle invalid key-value pairs**

**Цель:** Проверка обработки некорректных строк вида "ключ = значение".

**Описание:** Этот тест проверяет, что метод `_parse_key_value()` корректно обрабатывает ошибочные строки, такие как некорректное имя ключа или отсутствие оператора `=`.

**Ожидаемый результат:**
- Метод должен выбросить `ValueError`, если строка не соответствует ожидаемому формату.

### Как запускать тесты

1. Склонируйте репозиторий или загрузите исходный код.
2. Установите все необходимые зависимости (если они есть).
3. Выполните команду для запуска тестов:

    ```bash
    python -m unittest discover
    ```

Тесты проверят все основные функции класса `ConfigParser` и обеспечат, что конфигурации корректно парсятся, выражения правильно вычисляются, а ошибки обрабатываются должным образом.

  
## Как запускать тесты

После установки всех зависимостей, запустите тесты с помощью команды:

```bash
pytest main_test.py
```
![image](https://github.com/user-attachments/assets/dd4b8502-ef02-45b9-ae90-3d0b4342ccf0)


